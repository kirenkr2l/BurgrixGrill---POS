<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BURGRIX POS</title>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:10px;background:#fff7f2;color:#333;}
h1,h3{text-align:center;margin:5px;}
section{margin-bottom:15px;}
button{padding:10px;margin:3px;font-size:14px;border:none;border-radius:8px;color:#fff;cursor:pointer;transition:0.2s;}
button:active{transform:scale(0.95);}
.item-btn{background:#ff6a00;}
.extra-btn{background:#6a5acd;}
.qty-btn{background:#444;}
.payment-btn{background:#00b050;}
.active{outline:3px solid #000;background-color:#ffa500;}
.submit-btn{width:100%;padding:15px;font-size:18px;border-radius:10px;background:#0073e6;color:#fff;margin-top:10px;}
.reset-btn{background:#ff4d4d;}
.undo-btn{background:#ffa500;}
.total,.order-summary{font-size:18px;font-weight:bold;margin-top:10px;}
.order-item{background:#ffe0c4;border-radius:6px;padding:10px;margin-bottom:5px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
.order-status{font-size:12px;padding:3px 6px;border-radius:4px;color:#fff;}
.status-Pending{background:#ff9900;}
.status-Preparing{background:#0073e6;}
.status-Completed{background:#28a745;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:999;}
.modal-content{background:#fff;padding:15px;border-radius:10px;width:90%;max-width:400px;position:relative;}
.close-modal{position:absolute;top:5px;right:10px;font-size:20px;cursor:pointer;font-weight:bold;color:#ff4d4d;}
.modal-content button{width:100%;margin:5px 0;padding:10px;border-radius:8px;font-size:16px;}
.admin-panel{display:none;background:#f0f0f0;padding:10px;border-radius:8px;margin-top:10px;}
.admin-input{margin-bottom:5px;width:100%;padding:5px;font-size:14px;}
#adminBtn{position: fixed;top: 10px;right: 10px;background:#0073e6;color:#fff;border:none;padding:12px 15px;border-radius:50px;cursor:pointer;z-index:999;box-shadow:0 4px 8px rgba(0,0,0,0.3);font-weight:bold;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
table, th, td{border:1px solid #ccc;}
th, td{padding:5px;text-align:left;}
button.edit-btn{background:#ffa500;font-size:12px;padding:5px;}
button.delete-btn{background:#ff4d4d;font-size:12px;padding:5px;}
.low-stock{color:red;font-weight:bold;}
</style>
</head>
<body>

<button id="adminBtn" onclick="toggleAdmin()">Admin</button>

<h1>üçî BURGRIX POS</h1>

<!-- STAFF POS -->
<section>
<h3>Main Menu</h3>
<div id="menuItems"></div>
</section>

<section>
<h3>Add-ons (Optional)</h3>
<div id="extraItems"></div>
</section>

<section>
<h3>Quantity (1‚Äì20)</h3>
<div id="qtyButtons"></div>
</section>

<section>
<h3>Payment Method</h3>
<div id="paymentButtons"></div>
</section>

<section>
<div class="total" id="grandTotal">Subtotal: RM 0.00</div>
<button class="submit-btn" onclick="addToOrder()">Add to Order</button>
<button class="submit-btn" onclick="submitOrders()">Submit Orders</button>
<div id="ackButtons" style="display:none;text-align:center;margin-top:10px;">
    <button class="submit-btn" style="background:#00b050;" onclick="ackPayment()">Payment Received</button>
    <button class="submit-btn" style="background:#ff9900;" onclick="ackPrepare()">Proceed to Prepare Orders</button>
</div>
<button class="submit-btn reset-btn" onclick="resetOrder()">Reset Order</button>
<button class="submit-btn undo-btn" onclick="undoLast()">Undo Last</button>
</section>

<section>
<h3>Last Orders</h3>
<div id="orderList"></div>
</section>

<div id="orderModal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <div id="modalContent"></div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="admin-panel">
<h3>Admin Panel ‚Äì BURGRIX POS</h3>

<label>Password:</label>
<input class="admin-input" type="password" id="adminPass" placeholder="Enter password">
<button class="submit-btn" style="background:#0073e6;" onclick="unlockAdmin()">Unlock</button>

<div id="adminContent" style="display:none;">

<!-- MENU MANAGEMENT -->
<h4>Main Menu</h4>
<table id="menuTable">
<thead><tr><th>Name</th><th>Price</th><th>Active</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>
<input class="admin-input" id="newMenuName" placeholder="Burger Name">
<input class="admin-input" id="newMenuPrice" type="number" step="0.01" placeholder="Price">
<button class="submit-btn" style="background:#28a745;" onclick="addNewMenu()">Add Menu</button>

<!-- ADD-ONS -->
<h4>Add-ons</h4>
<table id="extraTable">
<thead><tr><th>Name</th><th>Price</th><th>Active</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>
<input class="admin-input" id="newExtraName" placeholder="Add-on Name">
<input class="admin-input" id="newExtraPrice" type="number" step="0.01" placeholder="Price">
<button class="submit-btn" style="background:#28a745;" onclick="addNewExtra()">Add Add-on</button>

<!-- INVENTORY -->
<h4>Inventory</h4>
<table id="inventoryTable">
<thead><tr><th>Item</th><th>Stock</th><th>Low Alert</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<!-- RECIPES -->
<h4>Recipes</h4>
<table id="recipeTable">
<thead><tr><th>Menu</th><th>Ingredient</th><th>Qty</th><th>Actions</th></tr></thead>
<tbody></tbody>
</table>

<!-- EXPENSES -->
<h4>Daily Expenses</h4>
<input class="admin-input" id="expName" placeholder="Expense name">
<input class="admin-input" id="expAmount" type="number" placeholder="Amount (RM)">
<label><input type="checkbox" id="invCheck"> Affects Inventory</label>
<div id="invExpenseFields" style="display:none;">
<input class="admin-input" id="invItem" placeholder="Inventory item">
<input class="admin-input" id="invQty" type="number" placeholder="Quantity added">
</div>
<button class="submit-btn" onclick="addExpense()">Add Expense</button>
<div id="expenseList"></div>

<!-- DAILY STATS -->
<h4>Daily Stats</h4>
<div>
<div>Sales: RM <span id="todaySales">0.00</span></div>
<div>Expenses: RM <span id="dailyExpense">0.00</span></div>
<div>Profit: <span id="todayProfit" style="color:#28a745;">RM 0.00</span></div>
</div>

</div>
</div>

<script>
// ========== DATA ==========
// Menu & extras
let menu=[{id:1,name:"Chicken Burger",price:13.9,active:true},{id:2,name:"Mutton Burger",price:16,active:true},{id:3,name:"Beef Burger",price:18,active:true},{id:4,name:"Cheese Burger",price:14.5,active:true},{id:5,name:"Veggie Burger",price:12.5,active:true},{id:6,name:"Spicy Chicken Burger",price:15,active:true}];
let extras=[{id:1,name:"Cheese Slice",price:2,active:true},{id:2,name:"Extra Patty",price:5,active:true},{id:3,name:"Bacon",price:3,active:true},{id:4,name:"Mushroom",price:2.5,active:true},{id:5,name:"Fried Egg",price:2,active:true}];

// Inventory
let inventory={bun:{stock:100,low:20},chickenPatty:{stock:80,low:15},beefPatty:{stock:50,low:10},tomato:{stock:200,low:40},cheese:{stock:150,low:30},sauce:{stock:500,low:100}};

// Recipes
let recipes={"Chicken Burger":{bun:1,chickenPatty:1,tomato:2,cheese:1,sauce:1},"Beef Burger":{bun:1,beefPatty:1,tomato:2,cheese:1,sauce:1}};

// Payment methods
let payments=["Cash","QR ‚Äì Maybank","QR ‚Äì TnG","PH ‚Äì PowerHouzz"];

// State
let selectedItem=null, selectedExtras=[], quantity=1, paymentMethod="", currentOrders=[], lastAdded=null;
let expenses=[];

// ========== STAFF POS RENDER ==========
function renderMenu(){
 const div=document.getElementById("menuItems"); div.innerHTML="";
 menu.forEach(item=>{if(!item.active) return;
 const btn=document.createElement("button"); btn.className="item-btn"; btn.disabled=item.stock<=0;
 btn.innerText=`${item.name} ‚Äì RM${item.price.toFixed(2)} (Stock:${getStock(item.name)})`;
 btn.onclick=()=>{if(selectedItem&&selectedItem.name===item.name){selectedItem=null;btn.classList.remove('active');selectedExtras=[];document.querySelectorAll('.extra-btn').forEach(b=>b.classList.remove('active'));updateSubtotalDisplay();return;}selectedItem={...item};document.querySelectorAll('.item-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');selectedExtras=[];document.querySelectorAll('.extra-btn').forEach(b=>b.classList.remove('active'));updateSubtotalDisplay();};
 div.appendChild(btn);});
}

function renderExtras(){
 const div=document.getElementById("extraItems"); div.innerHTML="";
 extras.forEach(item=>{if(!item.active) return;
 const btn=document.createElement("button"); btn.className="extra-btn"; btn.disabled=item.stock<=0;
 btn.innerText=`${item.name} ‚Äì RM${item.price.toFixed(2)} (Stock:${getStock(item.name)})`;
 btn.onclick=()=>{const idx=selectedExtras.findIndex(e=>e.name===item.name);if(idx>-1){selectedExtras.splice(idx,1);btn.classList.remove('active');}else{selectedExtras.push({...item});btn.classList.add('active');}updateSubtotalDisplay();};
 div.appendChild(btn);});
}

// Quantity
const qtyDiv=document.getElementById("qtyButtons");
for(let i=1;i<=20;i++){const btn=document.createElement("button"); btn.className="qty-btn"; btn.innerText=i;
 btn.onclick=()=>{quantity=i; document.querySelectorAll('.qty-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); updateSubtotalDisplay();};
 qtyDiv.appendChild(btn);}

// Payment buttons
function renderPayments(){const div=document.getElementById("paymentButtons"); div.innerHTML=""; payments.forEach(p=>{const btn=document.createElement("button"); btn.className="payment-btn"; btn.innerText=p; btn.onclick=()=>setPayment(p,btn); div.appendChild(btn);});}
function setPayment(p,btn){if(paymentMethod===p){paymentMethod=""; btn.classList.remove('active'); return;} paymentMethod=p; document.querySelectorAll('.payment-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active');}

// Subtotal
function updateSubtotalDisplay(){let subtotal=0;if(selectedItem){subtotal+=selectedItem.price*quantity; selectedExtras.forEach(e=>subtotal+=e.price*quantity);} document.getElementById("grandTotal").innerText=`Subtotal: RM ${subtotal.toFixed(2)}`;}

// Add to Order
function addToOrder(){if(!selectedItem){alert("Select a burger."); return;}
 let nameLine=selectedItem.name; if(selectedExtras.length>0) nameLine+=" + "+selectedExtras.map(e=>e.name).join(", ");
 let subtotal=parseFloat((selectedItem.price*quantity+selectedExtras.reduce((a,b)=>a+b.price*quantity,0)).toFixed(2));
 let orderObj={ name:nameLine, qty:quantity, price:subtotal, status:"Pending", mainItem:selectedItem.name, extras:[...selectedExtras], timeOrdered:new Date(), timePreparing:null, timeCompleted:null };
 currentOrders.push(orderObj); lastAdded=orderObj;
 updateOrderList(); selectedItem=null; selectedExtras=[]; quantity=1; document.querySelectorAll('.item-btn,.extra-btn,.qty-btn').forEach(b=>b.classList.remove('active')); updateSubtotalDisplay();}

// Order list
function updateOrderList(){const listDiv=document.getElementById("orderList"); listDiv.innerHTML=""; let total=0; currentOrders.forEach((o,index)=>{total+=o.price; const div=document.createElement("div"); div.className="order-item"; div.innerHTML=`<span>${o.name} x ${o.qty} ‚Äì RM ${o.price.toFixed(2)}</span> <span class="order-status status-${o.status}">${o.status}</span>`; div.onclick=()=>{openModal(o);}; listDiv.appendChild(div);}); document.getElementById("grandTotal").innerText=`Total: RM ${total.toFixed(2)}`;}

// Modal
let modalOrder=null;
function openModal(order){document.getElementById("modalContent").innerHTML=`<p><strong>${order.mainItem}</strong></p>${order.extras.length>0?`<p>Add-ons: ${order.extras.map(e=>e.name).join(", ")}</p>`:""}<p>Qty: ${order.qty}</p><p>Subtotal: RM ${order.price.toFixed(2)}</p><p>Status: ${order.status}</p><p>Time Ordered: ${formatDate(order.timeOrdered)}</p><p>Time Preparing: ${order.timePreparing?formatDate(order.timePreparing):'-'}</p><p>Time Completed: ${order.timeCompleted?formatDate(order.timeCompleted):'-'}</p><button style="background:#0073e6;" onclick="markPreparing(${currentOrders.indexOf(order)})">Mark Preparing</button><button style="background:#28a745;" onclick="markCompleted(${currentOrders.indexOf(order)})">Mark Completed</button><button style="background:#ff4d4d;" onclick="deleteOrderModal()">Delete Order</button>`; document.getElementById("orderModal").style.display="flex"; modalOrder=order;}
function closeModal(){document.getElementById("orderModal").style.display="none"; modalOrder=null;}
function deleteOrderModal(){if(modalOrder){deleteOrder(currentOrders.indexOf(modalOrder)); closeModal();}}
function markPreparing(index){currentOrders[index].status="Preparing"; currentOrders[index].timePreparing=new Date(); updateOrderList(); openModal(currentOrders[index]);}
function markCompleted(index){currentOrders[index].status="Completed"; currentOrders[index].timeCompleted=new Date(); deductInventory(); updateOrderList(); openModal(currentOrders[index]); refreshDailyStats();}

// Stock helper
function getStock(itemName){for(let key in inventory){if(key.toLowerCase().includes(itemName.toLowerCase())) return inventory[key].stock;} return 0;}

// Reset/Undo
function deleteOrder(index){currentOrders.splice(index,1); updateOrderList(); renderMenu(); renderExtras();}
function resetOrder(){currentOrders=[]; lastAdded=null; selectedItem=null; selectedExtras=[]; quantity=1; paymentMethod=""; document.querySelectorAll('.item-btn,.extra-btn,.qty-btn,.payment-btn').forEach(b=>b.classList.remove('active')); updateOrderList(); updateSubtotalDisplay(); document.getElementById("ackButtons").style.display="none";}
function undoLast(){if(!lastAdded){alert("Nothing to undo."); return;} deleteOrder(currentOrders.indexOf(lastAdded)); lastAdded=null;}

// Submit / Ack
function submitOrders(){if(currentOrders.length===0){alert("Select items to order."); return;} if(!paymentMethod){alert("Select payment method."); return;} document.getElementById("ackButtons").style.display="block"; showAckMessage("Orders Submitted ‚úÖ","#0073e6");}
function ackPayment(){showAckMessage("Payment Received ‚úÖ","#00b050");}
function ackPrepare(){currentOrders.forEach(o=>{o.status="Preparing"; o.timePreparing=new Date();}); updateOrderList(); showAckMessage("Order in Preparation üî∂","#ff9900");}
function showAckMessage(msg,bg="#00b050"){ const d=document.createElement("div"); d.innerText=msg; Object.assign(d.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%,-50%)",background:bg,color:"#fff",padding:"20px 30px",borderRadius:"10px",fontSize:"18px",fontWeight:"bold",boxShadow:"0 4px 12px rgba(0,0,0,0.4)",zIndex:9999,textAlign:"center"}); document.body.appendChild(d); setTimeout(()=>{d.remove()},2000);}

// Admin Panel
function toggle
