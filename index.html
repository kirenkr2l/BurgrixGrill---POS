<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BURGRIX POS + Expenses + Inventory</title>
<style>
body{font-family:Arial,sans-serif;background:#f7f7f7;margin:0;padding:0;}
h1,h2,h3{text-align:center;margin:5px;}
.tab{display:flex;justify-content:space-around;background:#0073e6;color:#fff;padding:10px 0;cursor:pointer;}
.tab div{flex:1;text-align:center;}
.tab div.active{background:#005bb5;}
section{padding:10px;display:none;}
input,select,button{padding:8px;margin:5px 0;border-radius:6px;font-size:14px;}
button{cursor:pointer;transition:0.2s;border:none;color:#fff;}
button:hover{opacity:0.85;}
.add-btn{background:#0073e6;}
.delete-btn{background:#ff4d4d;}
.edit-btn{background:#ffa500;}
.expense-item, .order-item, .inventory-item{background:#fff;padding:10px;border-radius:6px;margin-bottom:5px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:999;}
.modal-content{background:#fff;padding:15px;border-radius:10px;width:90%;max-width:400px;position:relative;}
.close-modal{position:absolute;top:5px;right:10px;font-size:20px;cursor:pointer;font-weight:bold;color:#ff4d4d;}
.total-display{text-align:right;font-weight:bold;margin-top:5px;}
</style>
</head>
<body>

<h1>üçî BURGRIX SYSTEM</h1>

<div class="tab">
  <div id="tab-pos" class="active" onclick="showTab('pos')">POS</div>
  <div id="tab-exp" onclick="showTab('expenses')">Expenses</div>
  <div id="tab-inv" onclick="showTab('inventory')">Inventory</div>
</div>

<!-- POS Section -->
<section id="pos" style="display:block;">
<h2>POS / Orders</h2>
<div id="menuList"></div>
<h3>Last Orders</h3>
<div id="orderList"></div>
<div class="total-display" id="orderTotal">Total: RM 0.00</div>
</section>

<!-- Expenses Section (Admin only) -->
<section id="expenses">
<h2>Daily Expenses (Admin)</h2>
<input type="text" id="expenseDesc" placeholder="Description">
<input type="number" id="expenseAmount" placeholder="Amount (RM)" step="0.01">
<select id="expenseCategory">
  <option value="">Select Category / Inventory Item</option>
</select>
<button class="add-btn" onclick="addExpense()">Add Expense</button>
<div id="expenseList"></div>
<div class="total-display" id="totalExpense">Total: RM 0.00</div>
</section>

<!-- Inventory Section (Admin only) -->
<section id="inventory">
<h2>Inventory (Admin)</h2>
<div id="inventoryList"></div>
</section>

<!-- Admin Login Modal -->
<div id="adminModal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeAdminModal()">&times;</span>
    <h3>Admin Login</h3>
    <input type="password" id="adminPass" placeholder="Enter Password">
    <button class="add-btn" onclick="checkAdmin()">Login</button>
  </div>
</div>

<!-- Recipe Editor Modal -->
<div id="recipeModal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeRecipeModal()">&times;</span>
    <h3>Edit Recipe for <span id="recipeName"></span></h3>
    <div id="recipeInputs"></div>
    <button class="add-btn" onclick="saveRecipe()">Save Recipe</button>
  </div>
</div>

<script>
// ---------- DATA ----------
let inventory=[
  {name:"Bun", stock:50, unit:"pcs", price:0},
  {name:"Chicken Patty", stock:30, unit:"pcs", price:0},
  {name:"Mutton Patty", stock:20, unit:"pcs", price:0},
  {name:"Cheese Slice", stock:40, unit:"pcs", price:0},
  {name:"Tomato Slice", stock:60, unit:"pcs", price:0},
  {name:"Sauce", stock:100, unit:"ml", price:0}
];

let menu=[
  {name:"Chicken Burger", price:13.9, ingredients:[{item:"Bun",qty:1},{item:"Chicken Patty",qty:1},{item:"Cheese Slice",qty:1},{item:"Tomato Slice",qty:2},{item:"Sauce",qty:20}]},
  {name:"Mutton Burger", price:16, ingredients:[{item:"Bun",qty:1},{item:"Mutton Patty",qty:1},{item:"Cheese Slice",qty:1},{item:"Tomato Slice",qty:2},{item:"Sauce",qty:20}]}
];

let orders=[];
let expenses=[];
let adminLogged=false;
let editingMenuIndex=null;

// ---------- TAB FUNCTION ----------
function showTab(tab){
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(tab).style.display="block";
  document.querySelectorAll(".tab div").forEach(d=>d.classList.remove("active"));
  document.getElementById("tab-"+tab).classList.add("active");
  if(tab!=="pos" && !adminLogged){ openAdminModal(); }
  if(tab==="expenses"){ renderExpenseCategoryOptions(); }
  renderInventory();
}

// ---------- ADMIN ----------
function openAdminModal(){ document.getElementById("adminModal").style.display="flex"; }
function closeAdminModal(){ document.getElementById("adminModal").style.display="none"; }
function checkAdmin(){
  const pass=document.getElementById("adminPass").value;
  if(pass==="burgrix123"){ adminLogged=true; closeAdminModal(); alert("Admin Access Granted"); renderMenu(); } 
  else{ alert("Incorrect Password"); }
}

// ---------- POS ----------
function renderMenu(){
  const list=document.getElementById("menuList");
  list.innerHTML="";
  menu.forEach((m,i)=>{
    const div=document.createElement("div"); div.className="order-item";
    div.innerHTML=`<span>${m.name} ‚Äì RM ${m.price.toFixed(2)}</span>
      <div>
        <input type="number" id="qty-${i}" min="1" max="20" value="1" style="width:50px;">
        <button class="add-btn" onclick="addOrder(${i})">Add</button>
      </div>`;
    if(adminLogged){
      const btn=document.createElement("button");
      btn.innerText="Edit Recipe";
      btn.className="edit-btn";
      btn.onclick=()=>openRecipeModal(i);
      div.querySelector("div").appendChild(btn);
    }
    list.appendChild(div);
  });
}
function addOrder(index){
  const qty=parseInt(document.getElementById("qty-"+index).value);
  if(qty<1){ alert("Enter quantity"); return; }
  const item=menu[index];
  orders.push({menuItem:item.name, qty:qty, total:item.price*qty, ingredients:item.ingredients});
  // Deduct inventory based on recipe
  item.ingredients.forEach(ing=>{
    const inv=inventory.find(x=>x.name===ing.item);
    if(inv){ inv.stock-=ing.qty*qty; if(inv.stock<0) inv.stock=0; }
  });
  renderOrders();
  renderInventory();
}
function renderOrders(){
  const list=document.getElementById("orderList"); list.innerHTML="";
  let total=0;
  orders.forEach(o=>{
    total+=o.total;
    const div=document.createElement("div"); div.className="order-item";
    div.innerHTML=`<span>${o.menuItem} x ${o.qty} ‚Äì RM ${o.total.toFixed(2)}</span>`;
    list.appendChild(div);
  });
  document.getElementById("orderTotal").innerText=`Total: RM ${total.toFixed(2)}`;
}

// ---------- EXPENSES ----------
function renderExpenseCategoryOptions(){
  const select=document.getElementById("expenseCategory");
  select.innerHTML='<option value="">Select Category / Inventory Item</option>';
  inventory.forEach(i=>{
    const opt=document.createElement("option"); opt.value=i.name; opt.innerText=i.name;
    select.appendChild(opt);
  });
  const otherOpt=document.createElement("option"); otherOpt.value="Other"; otherOpt.innerText="Other";
  select.appendChild(otherOpt);
}
function addExpense(){
  const desc=document.getElementById("expenseDesc").value.trim();
  const amount=parseFloat(document.getElementById("expenseAmount").value);
  const cat=document.getElementById("expenseCategory").value;
  if(!desc || isNaN(amount) || !cat){ alert("Enter all fields"); return; }
  expenses.push({description:desc, amount:amount, category:cat, date:new Date()});
  // Update inventory if applicable
  if(cat!=="Other"){
    const inv=inventory.find(x=>x.name===cat);
    if(inv){ inv.stock+=1; } // Adjust quantity if needed
  }
  document.getElementById("expenseDesc").value="";
  document.getElementById("expenseAmount").value="";
  document.getElementById("expenseCategory").value="";
  renderExpenses();
  renderInventory();
}
function renderExpenses(){
  const list=document.getElementById("expenseList"); list.innerHTML="";
  let total=0;
  expenses.forEach(e=>{
    total+=e.amount;
    const div=document.createElement("div"); div.className="expense-item";
    div.innerHTML=`<span>${e.description} (${e.category}) ‚Äì RM ${e.amount.toFixed(2)}</span>`;
    list.appendChild(div);
  });
  document.getElementById("totalExpense").innerText=`Total: RM ${total.toFixed(2)}`;
}

// ---------- INVENTORY ----------
function renderInventory(){
  const list=document.getElementById("inventoryList"); list.innerHTML="";
  inventory.forEach((i,index)=>{
    const div=document.createElement("div"); div.className="inventory-item";
    div.innerHTML=`<span>${i.name} ‚Äì ${i.stock} ${i.unit}</span>
      <input type="number" id="inv-${index}" value="${i.stock}" style="width:60px;">
      <button class="add-btn" onclick="updateStock(${index})">Update</button>`;
    list.appendChild(div);
  });
}
function updateStock(index){
  const val=parseInt(document.getElementById("inv-"+index).value);
  if(isNaN(val) || val<0){ alert("Invalid stock"); return; }
  inventory[index].stock=val;
  renderInventory();
}

// ---------- RECIPE EDITOR ----------
function openRecipeModal(index){
  editingMenuIndex=index;
  const menuItem=menu[index];
  document.getElementById("recipeName").innerText=menuItem.name;
  const container=document.getElementById("recipeInputs");
  container.innerHTML="";
  menuItem.ingredients.forEach((ing,i)=>{
    const div=document.createElement("div");
    div.innerHTML=`${ing.item}: <input type="number" id="ing-${i}" value="${ing.qty}" min="0" style="width:60px;">`;
    container.appendChild(div);
  });
  document.getElementById("recipeModal").style.display="flex";
}
function saveRecipe(){
  const menuItem=menu[editingMenuIndex];
  menuItem.ingredients.forEach((ing,i)=>{
    const val=parseInt(document.getElementById("ing-"+i).value);
    if(!isNaN(val) && val>=0){ ing.qty=val; }
  });
  closeRecipeModal();
  alert("Recipe updated!");
}
function closeRecipeModal(){ document.getElementById("recipeModal").style.display="none"; }

// ---------- INITIAL RENDER ----------
renderMenu();
renderOrders();
</script>

</body>
</html>
